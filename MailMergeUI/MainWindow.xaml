<Window x:Class="MailMergeUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Mail Merge Professional" 
        Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#F5F9FF"
        ResizeMode="NoResize"
        WindowStyle="None"
        FontFamily="Segoe UI"
        AllowsTransparency="True">

    <Window.Resources>
        <!-- Brush Definitions -->
        <SolidColorBrush x:Key="PrimaryBlue" Color="#1976D2"/>
        <SolidColorBrush x:Key="PrimaryBlueDark" Color="#1565C0"/>
        <SolidColorBrush x:Key="PrimaryBlueLight" Color="#E3F2FD"/>
        <SolidColorBrush x:Key="AccentBlue" Color="#2196F3"/>
        <SolidColorBrush x:Key="TextDark" Color="#212121"/>
        <SolidColorBrush x:Key="TextLight" Color="#757575"/>
        <SolidColorBrush x:Key="DividerColor" Color="#E0E0E0"/>

        <!-- Gradient Brushes -->
        <LinearGradientBrush x:Key="PrimaryGradient" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#1976D2" Offset="0"/>
            <GradientStop Color="#1565C0" Offset="1"/>
        </LinearGradientBrush>

        <!-- Toolbar Button -->
        <Style TargetType="Button" x:Key="ToolbarButton">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryBlue}"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryBlue}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="0,6,0,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource PrimaryBlueLight}"/>
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBlue}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#BBDEFB"/>
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBlueDark}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Primary Blue Button -->
        <Style TargetType="Button" x:Key="PrimaryButton" BasedOn="{StaticResource ToolbarButton}">
            <Setter Property="Background" Value="{StaticResource PrimaryGradient}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource PrimaryBlueDark}"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource AccentBlue}"/>
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBlueDark}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource PrimaryBlueDark}"/>
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBlueDark}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Logout Button Style -->
        <Style TargetType="Button" x:Key="LogoutButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryBlue}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource PrimaryBlueLight}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#BBDEFB"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBox Style - Fixed to allow dropdown -->
        <Style TargetType="ComboBox" x:Key="ModernComboBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource TextDark}"/>
            <Setter Property="BorderBrush" Value="{StaticResource DividerColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <!-- Main border / content -->
                            <Border x:Name="border"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="6">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition Width="36"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Selected item display -->
                                    <ContentPresenter Grid.Column="0"
                                              x:Name="ContentSite"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                              Margin="{TemplateBinding Padding}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              HorizontalAlignment="Left"
                                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>

                                    <!-- Toggle button (arrow) -->
                                    <ToggleButton Grid.Column="1"
                                          x:Name="ToggleButton"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          Focusable="False"
                                          ClickMode="Press"
                                          Background="Transparent"
                                          BorderBrush="{x:Null}">
                                        <Path Data="M0,0 L4,4 8,0z"
                                      Width="10" Height="6"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"
                                      Fill="{StaticResource TextLight}"/>
                                    </ToggleButton>
                                </Grid>
                            </Border>

                            <!-- Popup for dropdown (required name PART_Popup) -->
                            <Popup x:Name="PART_Popup"
                           Placement="Bottom"
                           AllowsTransparency="True"
                           Focusable="False"
                           IsOpen="{TemplateBinding IsDropDownOpen}"
                           PopupAnimation="Slide"
                           PlacementTarget="{Binding RelativeSource={RelativeSource TemplatedParent}}">
                                <Border Background="White"
                                BorderBrush="{StaticResource DividerColor}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Margin="0,4,0,0">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="240">
                                        <!-- ItemsHost: controls inside here will be replaced by ComboBox items -->
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource PrimaryBlue}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="{StaticResource TextLight}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


        <Style x:Key="NavButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryBlue}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
    </Window.Resources>

    <Grid>

        <!-- Close Button overlay -->
        <Button Content="✕" 
            Width="30" Height="30" 
            Background="Transparent"
            Foreground="{StaticResource TextLight}"
            BorderThickness="0"
            HorizontalAlignment="Right" 
            VerticalAlignment="Top"
            Margin="-2"
            FontSize="12"
            Click="CloseButton_Click">
            <Button.Template>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="border" 
            Background="{TemplateBinding Background}"
            CornerRadius="15"
            Width="30" Height="30">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#10000000"/>
                            <Setter Property="Foreground" Value="{StaticResource TextDark}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Button.Template>
        </Button>

        <!-- Main Grid Split: Left controls+log | Right preview -->
        <Grid Margin="0,25,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header with Logout Button -->
            <Border Grid.Row="0" Background="White" Padding="16,8,16,8" BorderBrush="{StaticResource DividerColor}" BorderThickness="0,0,0,1">
                <Grid>
                    <TextBlock Text="Mail Merge Professional" FontSize="16" FontWeight="Bold" Foreground="{StaticResource PrimaryBlue}" VerticalAlignment="Center"/>
                    <Button x:Name="btnLogout" Content="🚪 Logout" Style="{StaticResource LogoutButton}" HorizontalAlignment="Right" Click="btnLogout_Click"/>
                </Grid>
            </Border>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="260"/>
                    <!-- Left panel fixed -->
                    <ColumnDefinition Width="*"/>
                    <!-- Right panel expands -->
                </Grid.ColumnDefinitions>

                <!-- Left Panel -->
                <Border Grid.Column="0" Background="White" BorderBrush="{StaticResource DividerColor}" BorderThickness="0,0,1,0">
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Controls -->
                            <RowDefinition Height="*"/>
                            <!-- Logs (take remaining space) -->
                        </Grid.RowDefinitions>

                        <!-- Controls Area -->
                        <Border Grid.Row="0" CornerRadius="8" Padding="0" Margin="0,0,0,16">
                            <StackPanel>
                                <Border Background="{StaticResource PrimaryGradient}" CornerRadius="8,8,0,0" Padding="16,12">
                                    <TextBlock Text="Mail Merge" 
                                       FontWeight="Bold" FontSize="18" 
                                       Foreground="White"/>
                                </Border>

                                <StackPanel Background="White">
                                    <Button Content="📄 Load Template" Style="{StaticResource ToolbarButton}" Click="btnLoadTemplate_Click"/>
                                    <Button Content="📑 Load CSV" Style="{StaticResource ToolbarButton}" Click="btnLoadCsv_Click"/>
                                    <Button Content="👁 Preview" Style="{StaticResource ToolbarButton}" Click="btnPreview_Click"/>
                                    <Button Content="💾 Export" Style="{StaticResource ToolbarButton}" Click="btnExport_Click"/>

                                    <Border Height="1" Background="{StaticResource DividerColor}" Margin="0,16"/>

                                    <TextBlock Text="Printer" FontWeight="SemiBold" Foreground="{StaticResource TextDark}" Margin="0,0,0,8"/>
                                    <ComboBox Name="cmbPrinters" Style="{StaticResource ModernComboBox}" Margin="0,0,0,12"/>
                                    <Button Content="🖨 Print" Style="{StaticResource PrimaryButton}" Click="btnPrint_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Log / Status Area -->
                        <Border Grid.Row="1" CornerRadius="8" Background="White">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <!-- Header -->
                                    <RowDefinition Height="*"/>
                                    <!-- Log content -->
                                </Grid.RowDefinitions>

                                <!-- Header -->
                                <Border Grid.Row="0" Background="{StaticResource PrimaryGradient}" CornerRadius="8,8,0,0" Padding="16,12">
                                    <TextBlock Text="Activity Log" Foreground="White" FontWeight="SemiBold"/>
                                </Border>

                                <!-- Content -->
                                <Border Grid.Row="1" Background="White" CornerRadius="0,0,8,8" Padding="1">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <TextBox Name="txtStatus" 
                                         Background="White" 
                                         Foreground="{StaticResource TextDark}" 
                                         BorderThickness="0" 
                                         AcceptsReturn="True" 
                                         TextWrapping="Wrap"
                                         Text="Ready..."
                                         FontFamily="Consolas" 
                                         Padding="16"
                                         IsReadOnly="True"/>
                                    </ScrollViewer>
                                </Border>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>

                <!-- Right Preview -->
                <Border Grid.Column="1" Margin="20" CornerRadius="8"
                Background="White" BorderBrush="{StaticResource DividerColor}" BorderThickness="1"
                SnapsToDevicePixels="True">
                    <Border.Effect>
                        <DropShadowEffect Color="#40000000" BlurRadius="12" ShadowDepth="0" Opacity="0.1"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Background="{StaticResource PrimaryBlueLight}" CornerRadius="8,8,0,0" Padding="16,12">
                            <TextBlock Text="Document Preview" FontWeight="SemiBold" Foreground="{StaticResource PrimaryBlue}"/>
                        </Border>

                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                            <Image Name="imgPreview" Stretch="Uniform" Margin="16"/>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

    </Grid>
</Window>