<Window x:Class="MailMergeUI.MailMergeWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Mail Merge Professional" 
        Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#F5F9FF"
        ResizeMode="NoResize"
        WindowStyle="None"
        FontFamily="Segoe UI"
        AllowsTransparency="True"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf">

    <Grid Name="MainGrid">

        <!-- Close Button overlay -->
        <Button Content="✕" 
            Width="30" Height="30" 
            Background="Transparent"
            Foreground="{DynamicResource TextLight}"
            BorderThickness="0"
            HorizontalAlignment="Right" 
            VerticalAlignment="Top"
            Margin="-2"
            FontSize="12"
            Click="CloseButton_Click">
            <Button.Template>
                <ControlTemplate TargetType="Button">
                    <Border x:Name="border" 
            Background="{TemplateBinding Background}"
            CornerRadius="15"
            Width="30" Height="30">
                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#10000000"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextDark}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Button.Template>
        </Button>

        <!-- Main Grid Split: Left controls+log | Right preview -->
        <Grid Margin="0,25,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header with Logout Button and Dark Mode Toggle -->
            <Border Grid.Row="0" Background="{DynamicResource HeaderBackgroundLight}" Padding="16,8,16,8" BorderBrush="{DynamicResource DividerColor}" BorderThickness="0,0,0,1">
                <Grid>
                    <TextBlock Text="Mail Merge" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource PrimaryBlue}" VerticalAlignment="Center"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button x:Name="btnBack" Content=" ← Back" Style="{StaticResource LogoutButton}" Click="btnBack_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <Grid Grid.Row="1" Background="{DynamicResource BackgroundLight}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="260"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel -->
                <Border Grid.Column="0" Background="{DynamicResource CardBackgroundLight}" BorderBrush="{DynamicResource DividerColor}" BorderThickness="0,0,1,0">
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Controls Area -->
                        <Border Grid.Row="0" CornerRadius="8" Padding="0" Margin="0,0,0,16" Background="{DynamicResource CardBackgroundLight}">
                            <StackPanel>

                                <StackPanel Background="{DynamicResource CardBackgroundLight}">
                                    <Button Content=" 📄 Load Template" Style="{DynamicResource MailButtonStyle}" Click="btnLoadTemplate_Click"/>
                                    <Button Content=" 📑 Load CSV" Style="{DynamicResource MailButtonStyle}" Click="btnLoadCsv_Click"/>
                                    <Button Content=" 👁 Preview" Style="{DynamicResource MailButtonStyle}" Click="btnPreview_Click"/>
                                    <Button Content=" 💾 Export" Style="{DynamicResource MailButtonStyle}" Click="btnExport_Click"/>

                                    <Border Height="1" Background="{DynamicResource DividerColor}" Margin="0,16"/>

                                    <TextBlock Text="Printer" FontWeight="SemiBold" Foreground="{DynamicResource TextDark}" Margin="0,0,0,8"/>
                                    <ComboBox Name="cmbPrinters" Style="{DynamicResource ModernComboBox}" Margin="0,0,0,12"/>
                                    <Button Content="🖨 Print" Style="{DynamicResource PrimaryButton}" Click="btnPrint_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Log / Status Area -->
                        <Border Grid.Row="1" CornerRadius="8" Background="{DynamicResource CardBackgroundLight}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Header -->
                                <Border Grid.Row="0" BorderThickness="1" BorderBrush="{DynamicResource PrimaryBlueDark}" Background="{DynamicResource PrimaryBlueLight}" CornerRadius="8,8,0,0" Padding="16,12">
                                    <TextBlock Text="Activity Log" Foreground="{DynamicResource PrimaryBlue}" FontWeight="SemiBold"/>
                                </Border>

                                <!-- Content -->
                                <Border Grid.Row="1" Background="{DynamicResource CardBackgroundLight}" CornerRadius="0,0,8,8" Padding="1">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <TextBox Name="txtStatus" 
                                         Background="{DynamicResource CardBackgroundLight}" 
                                         Foreground="{DynamicResource TextDark}" 
                                         BorderThickness="0" 
                                         AcceptsReturn="True" 
                                         TextWrapping="Wrap"
                                         Text="Ready..."
                                         FontFamily="Consolas" 
                                         Padding="16"
                                         IsReadOnly="True"/>
                                    </ScrollViewer>
                                </Border>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>

                <!-- Right Preview -->
                <Border Grid.Column="1" Margin="20" CornerRadius="8"
                Background="{DynamicResource CardBackgroundLight}" BorderBrush="{DynamicResource DividerColor}" BorderThickness="1"
                SnapsToDevicePixels="True">
                    <Border.Effect>
                        <DropShadowEffect Color="#40000000" BlurRadius="12" ShadowDepth="0" Opacity="0.1"/>
                    </Border.Effect>
                    <Grid >
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border BorderThickness="1" BorderBrush="{DynamicResource PrimaryBlueDark}" Background="{DynamicResource PrimaryBlueLight}" CornerRadius="8,8,0,0" Padding="16,12">
                            <TextBlock Text="Document Preview" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryBlue}"/>
                        </Border>

                        <wv2:WebView2 x:Name="PdfWebView" Grid.Row="1" Margin="8"/>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <Grid x:Name="LoaderOverlay"
              Background="#80000000"
              Visibility="Collapsed"
              Panel.ZIndex="10000"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch">

            <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border Background="#FF2C3E50" 
                        CornerRadius="12" 
                        Padding="30"
                        Width="300"
                        Height="120">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <ProgressBar Width="200" 
                                 Height="15" 
                                 IsIndeterminate="True"
                                 Foreground="#FF3498DB" 
                                 Margin="0,0,0,15"/>
                        <TextBlock Text="Processing..."
                               Foreground="White"
                               FontSize="16"
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               TextAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>