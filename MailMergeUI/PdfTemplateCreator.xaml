<UserControl x:Class="MailMergeUI.PdfTemplateCreator"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1000"
             FontFamily="Segoe UI"
             SnapsToDevicePixels="True"
             xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf">

    <UserControl.Resources>
        <!-- Theme Colors -->
        <SolidColorBrush x:Key="PrimaryBlue" Color="#1976D2"/>
        <SolidColorBrush x:Key="PrimaryBlueDark" Color="#1565C0"/>
        <SolidColorBrush x:Key="PrimaryBlueLight" Color="#E3F2FD"/>
        <SolidColorBrush x:Key="AccentBlue" Color="#2196F3"/>
        <SolidColorBrush x:Key="TextDark" Color="#212121"/>
        <SolidColorBrush x:Key="TextLight" Color="#757575"/>
        <SolidColorBrush x:Key="DividerColor" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="BackgroundLight" Color="#F5F9FF"/>
        <SolidColorBrush x:Key="CardBackgroundLight" Color="White"/>
        <SolidColorBrush x:Key="HeaderBackgroundLight" Color="White"/>

        <!-- Modern Button Style -->
        <!-- Modern Button Style -->
        <Style x:Key="ToolBarButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="{StaticResource PrimaryBlue}"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                        CornerRadius="6"
                        BorderBrush="Transparent"
                        SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"
                                      Margin="{TemplateBinding Padding}"
                                      RecognizesAccessKey="True"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource PrimaryBlueDark}"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="{StaticResource DividerColor}"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Opacity" Value="0.6"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ToolBarTextBoxStyle" TargetType="TextBox">
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="Padding" Value="6,3"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderBrush" Value="{StaticResource DividerColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="Border"
                                CornerRadius="6"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                          Margin="{TemplateBinding Padding}"
                                          SnapsToDevicePixels="True"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource PrimaryBlue}"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource PrimaryBlue}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern ComboBox Style -->
        <Style x:Key="ToolBarComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="Padding" Value="6,3"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderBrush" Value="{StaticResource DividerColor}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <!-- Main Border -->
                            <Border x:Name="Border"
                            CornerRadius="6"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">

                                <Grid>
                                    <!-- Displayed text -->
                                    <ContentPresenter Margin="6,2,25,2"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"/>

                                    <!-- Dropdown Arrow -->
                                    <ToggleButton Grid.Column="1"
                                          x:Name="DropDownToggle"
                                          Focusable="False"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          Background="Transparent"
                                          BorderThickness="0"
                                          HorizontalAlignment="Right"
                                          VerticalAlignment="Center"
                                          Width="25"
                                          Height="25"
                                          Cursor="Hand">
                                        <Path Data="M 0 0 L 4 4 L 8 0 Z"
                                      Fill="{StaticResource TextLight}"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"/>
                                    </ToggleButton>
                                </Grid>
                            </Border>

                            <!-- Popup for dropdown items -->
                            <Popup x:Name="PART_Popup"
                           Placement="Bottom"
                           IsOpen="{TemplateBinding IsDropDownOpen}"
                           AllowsTransparency="True"
                           Focusable="False"
                           PopupAnimation="Slide">
                                <Border CornerRadius="6"
                                Background="White"
                                BorderBrush="{StaticResource DividerColor}"
                                BorderThickness="1"
                                SnapsToDevicePixels="True">
                                    <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                        <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>

                        <!-- Template Bindings -->
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource PrimaryBlue}"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource PrimaryBlue}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


    </UserControl.Resources>

    <Grid Background="{StaticResource BackgroundLight}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0"
        Background="{StaticResource HeaderBackgroundLight}" 
        BorderBrush="{StaticResource DividerColor}" 
        BorderThickness="0,0,0,1"
        Padding="12,8">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" HorizontalAlignment="Left" Orientation="Horizontal" VerticalAlignment="Center" Margin="10">

                    <!-- Main actions -->
                    <Button Content="Add Text" Style="{StaticResource ToolBarButtonStyle}" Click="AddTextBlock_Click"/>

                    <Button Content="Add Image" Style="{StaticResource ToolBarButtonStyle}" Click="AddImage_Click"/>

                    <!-- Divider -->
                    <Rectangle Width="1" Height="20" Fill="{StaticResource DividerColor}" Margin="10,0"/>

                    <TextBlock Text="Add Form Field:" VerticalAlignment="Center" Foreground="{StaticResource TextLight}" Margin="10,0,5,0"/>

                    <ComboBox x:Name="FormFieldComboBox" Width="150" Style="{StaticResource ToolBarComboBoxStyle}"  SelectionChanged="FormFieldComboBox_SelectionChanged"/>

                    <!-- Divider -->
                    <Rectangle Width="1" Height="20" Fill="{StaticResource DividerColor}" Margin="10,0"/>

                    <TextBlock Text="Font:" VerticalAlignment="Center" Foreground="{StaticResource TextLight}" Margin="0,0,5,0"/>

                    <ComboBox x:Name="FontComboBox" Width="140" Style="{StaticResource ToolBarComboBoxStyle}" IsEnabled="False" SelectionChanged="FontComboBox_SelectionChanged"/>

                    <!-- Divider -->
                    <Rectangle Width="1" Height="20" Fill="{StaticResource DividerColor}" Margin="10,0"/>

                    <TextBlock Text="Font Size:" VerticalAlignment="Center" Foreground="{StaticResource TextLight}" Margin="10,0,5,0"/>

                    <ComboBox x:Name="FontSizeComboBox" Width="50" Style="{StaticResource ToolBarComboBoxStyle}"  IsEnabled="False" SelectionChanged="FontSizeComboBox_SelectionChanged"/>

                    <!-- Divider -->
                    <Rectangle Width="1" Height="20" Fill="{StaticResource DividerColor}" Margin="10,0"/>

                    <Button x:Name="DeleteButton" Content="Delete" Style="{StaticResource ToolBarButtonStyle}" Background="Red" IsEnabled="False" Click="Delete_Click"/>

                </StackPanel>

                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="10">

                    <TextBlock Text="Template Name:" 
                               VerticalAlignment="Center" 
                               Foreground="{StaticResource TextLight}" 
                               Margin="10,0,5,0"/>

                    <TextBox x:Name="TemplateNameTextBox" 
                             Width="150" 
                             Style="{StaticResource ToolBarTextBoxStyle}"
                             TextChanged="TemplateNameTextBox_TextChanged"/>

                    <Button Name="ExportButton" IsEnabled="False" Content="Export to PDF" Style="{StaticResource ToolBarButtonStyle}" Click="ExportPdf_Click"/>

                </StackPanel>

                <StackPanel Grid.Row="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="10">

                    <Button Name="LoadPdf" Content="Load PDF" Style="{StaticResource ToolBarButtonStyle}" Click="LoadPdf_Click"/>

                    <Button Name="LoadCSV" Content="Load CSV" Style="{StaticResource ToolBarButtonStyle}" Click="LoadCSV_Click"/>

                    <Rectangle Width="1" Height="20" Fill="{StaticResource DividerColor}" Margin="10,0"/>

                    <TextBlock Text="Add Date Field:" VerticalAlignment="Center" Foreground="{StaticResource TextLight}" Margin="10,0,5,0"/>

                    <ComboBox x:Name="DateFieldComboBox" Width="150" Style="{StaticResource ToolBarComboBoxStyle}"  SelectionChanged="DateFieldComboBox_SelectionChanged"/>

                </StackPanel>

                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="10">

                    <Button x:Name="PrevPage" Content="&lt;" Style="{StaticResource ToolBarButtonStyle}" IsEnabled="False" Click="PrevPage_Click"/>

                    <TextBlock x:Name="PageNumberText" Text="Page 0 of 0" VerticalAlignment="Center" Foreground="{StaticResource TextLight}" Margin="10,0"/>

                    <Button x:Name="NextPage" Content="&gt;" Style="{StaticResource ToolBarButtonStyle}" IsEnabled="False" Click="NextPage_Click"/>

                    <Button x:Name="BackButton" Content="Back" Style="{StaticResource ToolBarButtonStyle}" Background="Red" Click="BackButton_Click"/>

                </StackPanel>

            </Grid>
        </Border>



        <!-- Design Surface -->
        <ScrollViewer x:Name="CanvasBorder" Grid.Row="1" HorizontalScrollBarVisibility="Auto" 
                      VerticalScrollBarVisibility="Auto" Padding="20">
            <Border HorizontalAlignment="Center" VerticalAlignment="Top" Margin="20"
                    Background="{StaticResource CardBackgroundLight}" CornerRadius="8"
                    SnapsToDevicePixels="True">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="3" BlurRadius="12" 
                                      Opacity="0.35" Color="#999999"/>
                </Border.Effect>

                <!-- A4 Canvas -->
                <Canvas x:Name="TemplateCanvas"
                        Width="794" Height="1123"
                        MinWidth="794" MinHeight="1123"
                        MaxWidth="794" MaxHeight="1123"
                        PreviewMouseMove="TemplateCanvas_PreviewMouseMove"
                        PreviewMouseLeftButtonUp="TemplateCanvas_PreviewMouseLeftButtonUp"
                        MouseLeftButtonDown="TemplateCanvas_MouseLeftButtonDown">
                    <Canvas.Background>
                        <ImageBrush x:Name="PdfBackgroundBrush" Stretch="Uniform" RenderOptions.BitmapScalingMode="HighQuality"
                    RenderOptions.EdgeMode="Aliased" />
                    </Canvas.Background>
                </Canvas>
            </Border>
            
            
        </ScrollViewer>
        <wv2:WebView2 x:Name="PdfWebView" Grid.Row="1" Margin="8"/>
    </Grid>
</UserControl>
