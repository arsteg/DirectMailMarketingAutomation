<Window x:Class="MailMergeUI.Views.CampaignEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        mc:Ignorable="d"
        Title="Edit Campaign"
        Width="900" MinHeight="800"
        Background="{DynamicResource BackgroundLight}">

    <Border Background="{DynamicResource CardBackgroundLight}"
            Padding="30"
            CornerRadius="12"
            BorderBrush="{DynamicResource DividerColor}"
            BorderThickness="1"
            Margin="30"
            Effect="{DynamicResource ShadowEffect}">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel>

                <!-- Header -->
                <TextBlock Text="Edit Campaign"
                           FontSize="22"
                           FontWeight="Bold"
                           Foreground="{DynamicResource PrimaryBlue}"
                           Margin="0,0,0,20"/>

                <!-- Campaign Name -->
                <StackPanel Margin="0,0,0,15">
                    <TextBlock Text="Campaign Name"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource TextDark}"
                               Margin="0,0,0,5"/>
                    <TextBox Text="{Binding Campaign.Name}"
                             Height="36"
                             Padding="8"
                             BorderBrush="{DynamicResource DividerColor}"
                             Background="{DynamicResource CardBackgroundLight}"
                             Foreground="{DynamicResource TextDark}"
                             BorderThickness="1"
                             />
                </StackPanel>

                <!-- A. Lead Source -->
                <Border Background="{DynamicResource CardBackgroundLight}"
                        CornerRadius="8"
                        Padding="20"
                        BorderBrush="{DynamicResource DividerColor}"
                        BorderThickness="1"
                        Margin="0,20,0,0"
                        Effect="{DynamicResource ShadowEffect}">
                    <StackPanel>
                        <TextBlock Text="A. Lead Source (API Search)"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource PrimaryBlue}"
                                   Margin="0,0,0,15"/>

                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="API URL:" Grid.Row="0" Grid.Column="0"
                                       Foreground="{DynamicResource TextDark}" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding Campaign.LeadSource.ApiUrl}"
                                     Grid.Row="0" Grid.Column="1"
                                     Height="32" Padding="6"
                                     Margin="8,4"
                                     BorderBrush="{DynamicResource DividerColor}"
                                     />

                            <TextBlock Text="API Key:" Grid.Row="1" Grid.Column="0"
                                       Foreground="{DynamicResource TextDark}" VerticalAlignment="Center"/>
                            <PasswordBox Grid.Row="1" Grid.Column="1"
                                         Margin="8,4" Height="32"
                                         Padding="6"
                                         BorderBrush="{DynamicResource DividerColor}"
                                         />

                            <TextBlock Text="Filters (JSON):" Grid.Row="2" Grid.Column="0"
                                       Foreground="{DynamicResource TextDark}" VerticalAlignment="Top" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding Campaign.LeadSource.FiltersJson}"
                                     Grid.Row="2" Grid.Column="1"
                                     Height="80" Padding="6"
                                     Margin="8,4"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     BorderBrush="{DynamicResource DividerColor}"
                                     />

                            <TextBlock Text="Run Daily At:" Grid.Row="3" Grid.Column="0"
                                       Foreground="{DynamicResource TextDark}" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding SelectedTime}"
                                     Grid.Row="3" Grid.Column="1"
                                     Width="100" Height="32"
                                     Padding="6"
                                     Margin="8,4"
                                     BorderBrush="{DynamicResource DividerColor}"
                                     />
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- B. Follow-Up Sequence -->
                <Border Background="{DynamicResource CardBackgroundLight}"
                        CornerRadius="8"
                        Padding="20"
                        BorderBrush="{DynamicResource DividerColor}"
                        BorderThickness="1"
                        Margin="0,20,0,0"
                        Effect="{DynamicResource ShadowEffect}">
                    <StackPanel>
                        <TextBlock Text="B. Follow-Up Sequence (Stages)"
                                   FontSize="16"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource PrimaryBlue}"
                                   Margin="0,0,0,15"/>

                        <ItemsControl ItemsSource="{Binding Stages}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="100"/>
                                            <ColumnDefinition Width="100"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox Text="{Binding StageName}"
                                                 Grid.Column="0"
                                                 Margin="0,0,8,0"
                                                 Height="32"
                                                 Padding="6"
                                                 BorderBrush="{DynamicResource DividerColor}"
                                                 />

                                        <ComboBox ItemsSource="{Binding DataContext.AvailableTemplates, RelativeSource={RelativeSource AncestorType=Window}}"
                                                  DisplayMemberPath="Name"
                                                  SelectedValue="{Binding TemplateId}"
                                                  SelectedValuePath="Id"
                                                  Grid.Column="1"
                                                  Margin="0,0,8,0"
                                                  Style="{StaticResource ModernComboBox}"/>

                                        <TextBox Text="{Binding DelayDays}"
                                                 Grid.Column="2"
                                                 Margin="0,0,8,0"
                                                 Height="32"
                                                 Padding="6"
                                                 BorderBrush="{DynamicResource DividerColor}"
                                                 />

                                        <Button Content="Remove"
                                                Command="{Binding DataContext.RemoveStageCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                Grid.Column="3"
                                                Style="{StaticResource ToolbarButton}"
                                                Foreground="Red"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <Button Content="+ Add Stage"
                                Command="{Binding AddStageCommand}"
                                Style="{StaticResource ToolbarButton}"
                                HorizontalAlignment="Left"
                                Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Save / Cancel -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Margin="0,30,0,0"
                            >
                    <Button Content="Save"
                            Command="{Binding SaveCommand}"
                            Style="{StaticResource PrimaryButton}"
                            Padding="20,8"/>
                    <Button Content="Cancel"
                            Command="{Binding CancelCommand}"
                            Style="{StaticResource ToolbarButton}"
                            Padding="20,8"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Border>
</Window>
